container:
    dockerfile: .cirrus_Dockerfile

# TODO: Syntax checking for debian/ folder contents?

validate_with_source_task:
    ungoogled_repo_cache:
        folder: ungoogled-chromium
        fingerprint_script: cat debian/ungoogled-upstream/version.txt
        populate_script:
            - wget "https://github.com/Eloston/ungoogled-chromium/archive/$(cat debian/ungoogled-upstream/version.txt).tar.gz" -O ungoogled-chromium_repo.tar.gz
            - tar xf ungoogled-chromium_repo.tar.gz
            - rm ungoogled-chromium_repo.tar.gz
            - mv "ungoogled-chromium-$(cat debian/ungoogled-upstream/version.txt)" ungoogled-chromium
    check_patch_files_script:
        - ./ungoogled-chromium/devutils/check_patch_files.py -p debian/patches
    merge_patches_script:
        - ./ungoogled-chromium/utils/patches.py merge -p debian/patches ungoogled-chromium/patches
    chromium_download_cache:
        folder: chromium_download_cache
        fingerprint_script: cat ungoogled-chromium/chromium_version.txt
        populate_script:
            - mkdir chromium_download_cache
            - ./ungoogled-chromium/utils/downloads.py retrieve -i ungoogled-chromium/downloads.ini -c chromium_download_cache
    unpack_source_script:
        - ./ungoogled-chromium/utils/downloads.py unpack -i ungoogled-chromium/downloads.ini -c chromium_download_cache chromium_src
    validate_patches_script:
        - ./ungoogled-chromium/devutils/validate_patches.py -l chromium_src -p debian/patches -s debian/patches/series

# vim: set expandtab shiftwidth=4 softtabstop=4:
